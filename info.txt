1. High-Level Architecture Overview
Goal
A book recommendation platform that:
Lets users sign up and fill a preference (KYC) form
Persists metadata and embeddings for ~200k books in Postgres
Periodically trains models to refresh embeddings and user vectors
Serves real-time personalized recommendations via an API


Core Components
Component
Description
Tech
Database
Stores books, users, interactions, and all embeddings
PostgreSQL + pgvector
Embedding/Training Jobs
Generate/update embeddings for content, CF, and GNN
Python jobs (cron or background workers)
API Service
Handles user auth, preferences, and /recommendendpoint
FastAPI + asyncpg
Model Store
Persist local trained models (e.g., ALS, GNN weights)
local models/ folder or S3
Data Preprocessing
Cleans metadata, builds text for embeddings
pandas, numpy
Frontend (optional)
React/Vue UI for user registration & recommendations
(can come later)














Flow Summary
User Signup â†’ KYC
User fills form (genres, authors, age, etc.)
Stored in users table with a text embedding of KYC data
Book Import
Script parses dataset dump (200k records)
Computes sentence embeddings (content_embedding)
Saves to Postgres
Training Jobs
CF (ALS): learns latent factors from user interactions
â†’ updates users.cf_vector, books.cf_embedding
GNN: learns relational embeddings from userâ€“book graph
â†’ updates books.gnn_vector
All embeddings persisted to Postgres
Recommendation
API aggregates user vectors (content + CF + GNN)
Queries Postgres for nearest neighbors via pgvector
Returns top recommendations (hybrid weighted score)
Feedback Loop
User actions logged as interactions
Training jobs periodically update embeddings with new data
























book-recommender/
â”‚
â”œâ”€â”€ ğŸ“ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                     # FastAPI entrypoint
â”‚   â”œâ”€â”€ config.py                   # env vars, DB URL, model paths
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection.py           # asyncpg connection pool
â”‚   â”‚   â””â”€â”€ schema.sql              # create tables, enable pgvector
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ book_model.py           # SQL + Pydantic models
â”‚   â”‚   â”œâ”€â”€ user_model.py
â”‚   â”‚   â””â”€â”€ interaction_model.py
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ auth.py                 # login/signup
â”‚   â”‚   â”œâ”€â”€ recommend.py            # /recommend endpoint
â”‚   â”‚   â””â”€â”€ users.py                # CRUD endpoints for users
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ recommender.py          # hybrid scoring logic
â”‚   â”‚   â”œâ”€â”€ embedding_service.py    # wraps SentenceTransformer
â”‚   â”‚   â”œâ”€â”€ cf_service.py           # CF scoring helper
â”‚   â”‚   â””â”€â”€ gnn_service.py          # GNN model utilities
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ preprocessing.py        # text cleaners, normalizers
â”‚       â”œâ”€â”€ vector_ops.py           # dot products, normalization
â”‚       â””â”€â”€ logger.py
â”‚
â”œâ”€â”€ ğŸ“ data/
â”‚   â”œâ”€â”€ books_dump.json             # 200k book dataset
â”‚   â”œâ”€â”€ interactions.csv            # user-book interactions
â”‚   â””â”€â”€ samples/                    # sample subsets for local dev
â”‚
â”œâ”€â”€ ğŸ“ notebooks/
â”‚   â”œâ”€â”€ train_cf.ipynb              # ALS training + update Postgres
â”‚   â”œâ”€â”€ train_gnn.ipynb             # GraphSAGE training example
â”‚   â””â”€â”€ embedding_exploration.ipynb # EDA on embeddings
â”‚
â”œâ”€â”€ ğŸ“ scripts/
â”‚   â”œâ”€â”€ ingest_books.py             # import + embed book dataset
â”‚   â”œâ”€â”€ build_content_embeddings.py # SentenceTransformer embedding job
â”‚   â”œâ”€â”€ train_cf.py                 # batch ALS training job
â”‚   â”œâ”€â”€ train_gnn.py                # batch GNN training job
â”‚   â””â”€â”€ refresh_user_vectors.py     # aggregate KYC + interactions
â”‚
â”œâ”€â”€ ğŸ“ models/
â”‚   â”œâ”€â”€ sentence_model/             # local SBERT cache
â”‚   â”œâ”€â”€ cf_model.pkl                # pickled ALS model
â”‚   â”œâ”€â”€ gnn_model.pt                # saved GNN weights
â”‚
â”œâ”€â”€ ğŸ“ tests/
â”‚   â”œâ”€â”€ test_recommend_api.py
â”‚   â”œâ”€â”€ test_embeddings.py
â”‚   â””â”€â”€ test_cf_model.py
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml              # spins up Postgres + FastAPI
â”œâ”€â”€ README.md
â””â”€â”€ .env











[User -> FastAPI /recommend]
         |
         v
[RecommenderService]
  1. Load user's KYC prefs & vectors
  2. Encode preferences via SentenceTransformer
  3. Query Postgres (pgvector) for nearest books
  4. Merge CF and GNN similarities
  5. Return top-N ranked books















D. Data Lifecycle
Step
Process
Data Updated
Import
Load & embed 200k books
books.content_embedding
CF training
Learn latent vectors from interactions
users.cf_vector, books.cf_embedding
GNN training
Learn structure embeddings
books.gnn_vector
Inference
Query vectors for recommendation
Uses all above
Feedback
Store clicks/ratings
interactions

































E. API Overview
Endpoint
Method
Description
/auth/signup
POST
Create user, store KYC + embeddings
/auth/login
POST
JWT login
/recommend
POST
Get recommendations (based on user_id or KYC prefs)
/books/{id}
GET
Get book details
/interactions
POST
Log click/like/view
/users/{id}
GET
Get user profile































      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Frontend   â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚ REST / JSON
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ FastAPI    â”‚
      â”‚ Recommenderâ”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚ asyncpg queries
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ PostgreSQL â”‚
      â”‚ + pgvector â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â–²
             â”‚ batch updates
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Training Jobs (Python)â”‚
   â”‚ - Embeddings (SBERT)  â”‚
   â”‚ - CF (ALS)            â”‚
   â”‚ - GNN (PyG)           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


